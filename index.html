<!DOCTYPE html>
<html>
<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
	
	<script src="leaflet.shpfile.js"></script>
	<script src="shp.js"></script>
	
	
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
	<!--[if lte IE 8]>
			<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
		<![endif]-->
	<style>
		html {
			height: 100%
		}

		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		#map {
			height: 400px;
			width:600px;
		}
	</style>
	
<body onload="init()">
    <input type="file" id="file" />
	<p>
	<div id="map"></div>
</body>

<script>
	var shpfile;
    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object
		var selFile = files[0];
        handleFile(selFile);
    }

	
	function handleFile(file){
	var reader = new FileReader();
        reader.onload = function(e) {
            
			
			shpfile = new L.Shapefile(e.target.result,{isArrayBufer:true});
			//console.log(shpfile);
			shpfile.addTo(m);
			shpfile.on("data:loaded", function (e){
			m.fitBounds(shpfile.getBounds());
		});

	
        };

        reader.onerror = function(e) {
            console.log(e);
        };
        reader.readAsArrayBuffer(file);
	
	}

    document.getElementById('file').addEventListener('change', handleFileSelect, false);
	var m ;
	function init(){
	
		m = L.map('map').setView([19.98, 72.76], 12);
		// m = L.map('map').setView([40, -80], 4);
		var watercolor = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
			attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
		});
		
		var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			});

		OpenStreetMap_BlackAndWhite.addTo(m);
		
		m.on('layeradd', function (e){
			//console.dir(e);
		});

		
		//set up stuff
		
		var dropbox = document.getElementById("map");
        dropbox.addEventListener("dragenter", dragenter, false);
        dropbox.addEventListener("dragover", dragover, false);
        dropbox.addEventListener("drop", drop, false);
        dropbox.addEventListener("dragleave", function() {
            m.scrollWheelZoom.enable();
        }, false);

        function dragenter(e) {
            e.stopPropagation();
            e.preventDefault();
            m.scrollWheelZoom.disable();
        }

        function dragover(e) {
            e.stopPropagation();
            e.preventDefault();
        }

        function drop(e) {
            e.stopPropagation();
            e.preventDefault();
            m.scrollWheelZoom.enable();
            var dt = e.dataTransfer;
            var files = dt.files;

            var i = 0;
            var len = files.length;
            if (!len) {
                return
            }
            while (i < len) {
                handleFile(files[i]);
                i++;
            }
        }
	
	}
</script>

</html>